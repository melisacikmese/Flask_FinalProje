<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Ki≈üisel B√ºt√ße Takip Uygulamasƒ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
        margin: 20px; 
        background-color: #f5f5f5;
    }
    .container { 
        max-width: 1000px; 
        margin: auto; 
        background-color: white; 
        padding: 30px; 
        border-radius: 12px; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.05); 
    }
    h1 { 
        color: #4CAF50; 
        text-align: center; 
        margin-bottom: 20px; 
    }
    h2 { 
        border-bottom: 2px solid #c8e6c9; 
        padding-bottom: 5px; 
        margin-top: 40px; 
        color: #555; 
    }
    .nav-bar { 
        display: flex; 
        justify-content: space-between; 
        align-items: center; 
        background-color: #e8f5e9; 
        padding: 10px 15px; 
        border-radius: 8px; 
        margin-bottom: 30px; 
    }
    .nav-bar a { 
        color: #4CAF50;
        text-decoration: none; 
        margin-left: 15px; 
        font-weight: bold;
    }
    .nav-bar strong { 
        color: #333; 
    }
    form { 
        background: #e8f5e9; 
        padding: 25px; 
        border-radius: 8px; 
        margin-bottom: 40px; 
        border: 1px solid #c8e6c9; 
    }
    input[type="text"], input[type="number"], select { 
        width: 100%; 
        padding: 10px; 
        margin-top: 5px; 
        margin-bottom: 15px; 
        border: 1px solid #c8e6c9; 
        border-radius: 6px; 
        box-sizing: border-box; 
    }
    input[type="submit"] { 
        background-color: #4CAF50; 
        color: white; 
        padding: 10px 20px; 
        border: none; 
        border-radius: 5px; 
        cursor: pointer; 
        transition: background-color 0.3s; 
    }
    input[type="submit"]:hover { 
        background-color: #388E3C; 
    }
    table { 
        width: 100%; 
        border-collapse: collapse; 
        margin-top: 20px; 
    }
    th, td { 
        padding: 12px; 
        border: 1px solid #c8e6c9; 
        text-align: left; 
    }
    th { 
        background-color: #4CAF50; 
    }
    .income { 
        color: #4CAF50; 
        font-weight: bold; 
    }
    .expense { 
        color: #dc3545; 
        font-weight: bold; 
    }
    .summary { 
        margin-top: 20px; 
        padding: 20px; 
        border: 1px solid #4CAF50; 
        border-radius: 8px; 
        background: #fff; 
        display: flex; 
        justify-content: space-around; 
    }
    .summary p { 
        margin: 0; 
        font-size: 1.1em; 
    }
    .chart-container { 
        margin-top: 30px; 
        padding: 20px; 
        border: 1px solid #c8e6c9; 
        border-radius: 8px; 
        background: #fff; 
    }
    
    [style*="border: 2px solid #dc3545"] {
        margin-top: 50px !important; 
        padding: 15px !important; 
        border: 2px solid #dc3545 !important; 
        border-radius: 8px !important; 
        background-color: #fffafa !important; 
    }
    [value="T√úM VERƒ∞LERƒ∞ SIFIRLA (Kalƒ±cƒ± Sil)"] {
        background-color: #dc3545 !important; 
    }

</style>
</head>
<body>
    <div class="container">
        <h1>üí∞ Ki≈üisel B√ºt√ße Takip Uygulamasƒ±</h1>
        
        <div class="nav-bar">
            <div>Ho≈ü geldiniz, <strong>{{ current_user.username }}</strong>!</div>
            <div>
                <a href="{{ url_for('logout') }}">√áƒ±kƒ±≈ü Yap</a>
            </div>
        </div>

        <h2>Yeni ƒ∞≈ülem Ekle</h2>
        <form method="POST">
            {{ form.hidden_tag() }}
            <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 200px;">
                    <label>Ba≈ülƒ±k</label>
                    {{ form.title() }}
                </div>
                <div style="flex: 1; min-width: 150px;">
                    <label>Miktar (TL)</label>
                    {{ form.amount(type="number", step="0.01") }}
                </div>
                <div style="flex: 1; min-width: 150px;">
                    <label>T√ºr</label>
                    {{ form.transaction_type() }}
                </div>
                <div style="flex: 1; min-width: 150px;">
                    <label>Kategori</label>
                    {{ form.category() }}
                </div>
                <div style="flex-basis: 100%; text-align: right;">
                    {{ form.submit() }}
                </div>
            </div>
        </form>

        <h2>B√ºt√ße √ñzeti</h2>
        <div class="summary">
            <p><strong>Toplam Gelir:</strong> <span class="income">{{ "{:,.2f}".format(total_income) }} TL</span></p>
            <p><strong>Toplam Gider:</strong> <span class="expense">{{ "{:,.2f}".format(total_expense) }} TL</span></p>
            <p><strong>Net Bakiye:</strong> 
                {% if net_balance >= 0 %}
                    <span class="income">{{ "{:,.2f}".format(net_balance) }} TL</span>
                {% else %}
                    <span class="expense">{{ "{:,.2f}".format(net_balance) }} TL</span>
                {% endif %}
            </p>
        </div>
        <div class="summary">
            </div> 


        {% if chart_data %}
        <div class="chart-container">
            <h2>üìà Gider Kategorileri Daƒüƒ±lƒ±mƒ±</h2>
            <canvas id="expenseChart" width="400" height="150"></canvas>
        </div>
        {% endif %}

        <h2>T√ºm ƒ∞≈ülemler</h2>
        <table>
            <thead>
                <tr>
                    <th>Ba≈ülƒ±k</th>
                    <th>T√ºr</th>
                    <th>Kategori</th>
                    <th>Miktar (TL)</th>
                    <th>Tarih</th>
                </tr>
            </thead>
            <tbody>
                {% for t in transactions %}
                <tr>
                    <td>{{ t.title }}</td>
                    <td class="{{ 'income' if t.type == 'Gelir' else 'expense' }}">
                        {{ t.type }}
                    </td>
                    <td>{{ t.category }}</td>
                    <td class="{{ 'income' if t.type == 'Gelir' else 'expense' }}">
                        {{ "{:,.2f}".format(t.amount | abs) }}
                    </td>
                    <td>{{ t.date.strftime('%d.%m.%Y %H:%M') }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        
    </div>

    {% if chart_data %}
    <script>
        var labels = {{ chart_labels | tojson }};
        var data = {{ chart_data | tojson }};
        
        var colors = [
            '#dc3545', '#ffc107', '#17a2b8', '#28a745', '#6c757d', 
            '#fd7e14', '#e83e8c', '#6f42c1', '#343a40', '#007bff'
        ];
        
        var ctx = document.getElementById('expenseChart').getContext('2d');
        var expenseChart = new Chart(ctx, {
            type: 'doughnut', 
            data: {
                labels: labels,
                datasets: [{
                    data: data,
                    backgroundColor: colors.slice(0, labels.length),
                    hoverOffset: 4
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'right',
                    },
                    title: {
                        display: true,
                        text: 'Gider Kategorileri Daƒüƒ±lƒ±mƒ± (TL)'
                    }
                }
            }
        });
    </script>
    {% endif %}


</table>
        
        
        <div style="margin-top: 50px; text-align: right; padding: 15px; border: 2px solid #dc3545; border-radius: 8px; background-color: #ffeaea;">
            <h3 style="color: #dc3545;">‚ö†Ô∏è Veri Sƒ±fƒ±rlama Alanƒ±</h3>
            <p>Bu alandaki butona basmak, **{{ current_user.username }}** hesabƒ±na ait **T√úM** b√ºt√ße i≈ülemlerini veritabanƒ±ndan kalƒ±cƒ± olarak silecektir.</p>
            
            <form method="POST" action="{{ url_for('reset_data') }}" 
                  onsubmit="return confirm('T√úM B√úT√áE KAYITLARINIZI siliyorsunuz. Bu i≈ülem geri alƒ±namaz! DEVAM ETMEK ƒ∞STƒ∞YOR MUSUNUZ?');">
                
                <input type="submit" value="T√úM VERƒ∞LERƒ∞ SIFIRLA (Kalƒ±cƒ± Sil)" 
                       style="background-color: #dc3545; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px;">
            </form>
        </div>

    </div> </body>
</html>